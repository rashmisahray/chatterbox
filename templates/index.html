{% extends 'base.html' %}

{% block content %}
<div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="user-profile">
                <img src="{{ current_user.avatar }}" alt="User" class="user-avatar">
                <div class="user-info">
                    <h3>{{ current_user.name }}</h3>
                    <div class="user-status">
                        <span class="status-dot {{ current_user.status }}"></span> {{ current_user.status | title }}
                    </div>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-link"><i class="ph ph-sign-out"></i></a>
            </div>
            <button id="create-group-btn" class="btn-icon" title="Create Group"
                style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-top: 1rem; width: 100%;">
                <i class="ph ph-plus" style="margin-right: 0.5rem;"></i> New Group
            </button>
        </div>

        <div class="sidebar-search">
            <input type="text" class="search-input" placeholder="Search chats...">
        </div>

        <div class="chat-list" id="chat-list">
            <!-- Chat items will be populated by JS -->
            <div class="empty-state" style="height: 100px;">
                <i class="ph ph-spinner-gap ph-spin"></i>
            </div>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area" id="chat-area">
        <div class="empty-state">
            <i class="ph ph-chat-circle-text"></i>
            <h3>Select a conversation</h3>
            <p>Start chatting with your friends and groups</p>
        </div>
    </div>
</div>

<!-- Template for Chat Window (hidden, used by JS) -->
<template id="chat-window-template">
    <div class="chat-header">
        <div class="chat-header-user">
            <img src="" alt="" class="user-avatar" id="header-avatar">
            <div>
                <h3 id="header-name"></h3>
                <span class="user-status" id="header-status"></span>
            </div>
        </div>
        <div class="chat-actions">
            <!-- Future actions: call, video, info -->
            <i class="ph ph-dots-three-circle"
                style="font-size: 1.5rem; color: var(--text-muted); cursor: pointer;"></i>
        </div>
    </div>

    <div class="messages-container" id="messages-container">
        <!-- Messages go here -->
    </div>

    <div class="chat-input-area">
        <div class="input-wrapper">
            <i class="ph ph-plus" style="color: var(--text-muted); cursor: pointer;"></i>
            <input type="text" id="message-input" placeholder="Type a message...">
            <i class="ph ph-smiley" style="color: var(--text-muted); cursor: pointer;"></i>
        </div>
        <!-- Using a separate send button outside or handling Enter key. 
             But design shows "Send" button block usually. 
             Let's put a send button next to input if needed, or inside -->
    </div>
    <!-- Actually, let's append a Send button programmatically or just rely on Enter.
         The provided image showed a "Send" button. Let's add it. -->
    <div style="position: absolute; bottom: 1.5rem; right: 1.5rem; height: 50px; display: flex; align-items: center;">
        <button class="send-btn" id="send-btn">
            <i class="ph ph-paper-plane-right" style="font-size: 1.2rem;"></i>
        </button>
    </div>
</template>

<!-- Group Creation Modal -->
<dialog id="group-modal"
    style="background: var(--bg-card); color: white; border: 1px solid var(--border); border-radius: 1rem; padding: 2rem; backdrop-filter: blur(20px); width: 400px; margin: auto;">
    <h2 style="margin-bottom: 1rem;">Create New Group</h2>
    <input type="text" id="new-group-name" placeholder="Group Name" class="form-input" style="margin-bottom: 1rem;">

    <label
        style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-muted);">Participants:</label>
    <div id="user-selection-list"
        style="max-height: 200px; overflow-y: auto; margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem;">
        <!-- Checkboxes injected by JS -->
    </div>

    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
        <button id="cancel-group"
            style="padding: 0.5rem 1rem; background: transparent; border: 1px solid var(--border); color: white; border-radius: 0.5rem; cursor: pointer;">Cancel</button>
        <button id="confirm-group" class="btn-primary" style="width: auto;">Create</button>
    </div>
</dialog>

<!-- Profile Settings Modal -->
<dialog id="profile-modal"
    style="background: var(--bg-card); color: white; border: 1px solid var(--border); border-radius: 1rem; padding: 2rem; backdrop-filter: blur(20px); width: 400px; margin: auto;">
    <h2 style="margin-bottom: 1rem;">Edit Profile</h2>

    <label class="form-label" style="display:block; margin-bottom: 0.5rem; color: var(--text-muted);">Nickname</label>
    <input type="text" id="edit-profile-name" class="form-input" style="margin-bottom: 1rem;">

    <label class="form-label" style="display:block; margin-bottom: 0.5rem; color: var(--text-muted);">Gender (Updates
        Avatar)</label>
    <select id="edit-profile-gender" class="form-input" style="background: var(--bg-item); margin-bottom: 1.5rem;">
        <option value="">No Change</option>
        <option value="male">ðŸ‘¨ Male</option>
        <option value="female">ðŸ‘© Female</option>
    </select>

    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
        <button id="cancel-profile"
            style="padding: 0.5rem 1rem; background: transparent; border: 1px solid var(--border); color: white; border-radius: 0.5rem; cursor: pointer;">Cancel</button>
        <button id="confirm-profile" class="btn-primary" style="width: auto;">Save</button>
    </div>
</dialog>
{% endblock %}